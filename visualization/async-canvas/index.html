<!DOCTYPE html>
<html>
<head>
	<title>MatViz 0621</title>
	<style>
		canvas {
			border: 1px solid black;
		}
		table {
			border-collapse: collapse;
			margin: auto;
		}
		td {
			width: 25px;
			height: 25px;
			text-align: center;
			border: 1px solid black;
		}
	</style>
</head>
<body>
	<div>
		<label for="input-m">Rows:</label>
		<input type="text" id="input-m" value="1000">
		<label for="input-n">Columns:</label>
		<input type="text" id="input-n" value="1000">
        <label for="input-zoom">Zoom:</label>
		<input type="text" id="input-zoom" value="1.0">
		<button onclick="applySize()">Apply</button>
		<!-- <p class="comment" id="expComment">Experiment comment here.</p> -->
	</div>
	<br>
	<canvas id="canvas"></canvas>
</body>
<script>
	// var expComment = document.getElementById("expComment");

	function applySize() {
		var m = document.getElementById("input-m").value;
		var n = document.getElementById("input-n").value;
        var zoom = document.getElementById("input-zoom").value;
		generateMatrix('canvas', m, n, zoom);

	}

    function generateMatrix(id, m, n, zoom) {
		// var canvas = document.getElementById(id);
        // canvas.height = m * zoom;
        // canvas.width = n * zoom;
		// var ctx = canvas.getContext("2d");
        // ctx.scale(zoom, zoom);

		// for (var i = 0; i < m; i++) {
		// 	// expComment.innerText = "Current id: " + id + " Current line: " + i + "/" + m;
		// 	for (var j = 0; j < n; j++) {
		// 		// ctx.fillStyle = (Math.floor(Math.random() * 2) == 0) ? "black" : "red";
        //         ctx.fillStyle = (Math.floor(Math.random() * 2) == 0) ? "rgba(225,225,225,0.5)" : "rgba(225,0,0,0.5)";
		// 		ctx.fillRect(j, i, 1, 1);
		// 	}
		// }

		var updateImage = document.getElementById(id);
        updateImage.height = m * zoom;
        updateImage.width = n * zoom;
		updateImage.style.width = `${updateImage.width}px`;
		updateImage.style.height = `${updateImage.height}px`;

		var ctx = updateImage.getContext("2d");
		ctx.scale(zoom, zoom);

		var screenHeight = m * zoom; //
        var screenWidth = n * zoom; //
		var updateImageData = ctx.createImageData(screenWidth, screenHeight);


        
		var makeRenderLoop = function*() {
			for (var i = 0; i < m; i++) {
				for (var j = 0; j < n; j++) {
					// Pretend you have actual rendering code here...
					var x = Math.floor(Math.random() * screenWidth);
					var y = Math.floor(Math.random() * screenHeight);

					var r = 255;
					var g = 0;
					var b = 0; // Math.floor(Math.random() * 255);

					// write to a pixel
					var pix = (x + y * screenWidth) * 4;
					updateImageData.data[pix + 0] = r;
					updateImageData.data[pix + 1] = g;
					updateImageData.data[pix + 2] = b;
					updateImageData.data[pix + 3] = 255;
					
					yield;
				}
			}
		};

		var coroutine = makeRenderLoop();

		function drawFrame(time) {
			// Run the "infinite" loop for a while
			for (var i = 0; i < 100; ++i) {
				coroutine.next();
			}
			
			// Update the image
			updateImage.getContext('2d').putImageData(updateImageData, 0, 0);
			ctx.drawImage(updateImage, 0, 0, screen.width, screen.height);

			// Keep the callback chain going
			requestAnimationFrame(drawFrame);
		}

		requestAnimationFrame(drawFrame);

	}
</script>
</html>